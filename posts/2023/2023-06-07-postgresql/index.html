<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Park API - Using PostgreSQL instead of SQLite | Flying blind - coding nonsense</title>
<meta name=keywords content="iOS,macOS,swift,server,git,hummingbird,api,postgresql,docker"><meta name=description content="In the previous part of the article we built our first API server based on Swift using Hummingbird framework. That time we stored our data in SQLite database, which is perfect for rapid prototyping but for production we need something more robust.
Feather Database Component allows us to use PostgreSQL database as well. We need to make small modifications on our code.
Step 1. - Run PostgreSQL database as container I prefer to use containers if I know that the development and the production environment most probably are different."><meta name=author content="Szabolcs Tóth"><link rel=canonical href=https://kicsipixel.github.io/posts/2023/2023-06-07-postgresql/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://kicsipixel.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kicsipixel.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kicsipixel.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kicsipixel.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kicsipixel.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Park API - Using PostgreSQL instead of SQLite"><meta property="og:description" content="In the previous part of the article we built our first API server based on Swift using Hummingbird framework. That time we stored our data in SQLite database, which is perfect for rapid prototyping but for production we need something more robust.
Feather Database Component allows us to use PostgreSQL database as well. We need to make small modifications on our code.
Step 1. - Run PostgreSQL database as container I prefer to use containers if I know that the development and the production environment most probably are different."><meta property="og:type" content="article"><meta property="og:url" content="https://kicsipixel.github.io/posts/2023/2023-06-07-postgresql/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-07T12:04:31+02:00"><meta property="article:modified_time" content="2023-06-07T12:04:31+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Park API - Using PostgreSQL instead of SQLite"><meta name=twitter:description content="In the previous part of the article we built our first API server based on Swift using Hummingbird framework. That time we stored our data in SQLite database, which is perfect for rapid prototyping but for production we need something more robust.
Feather Database Component allows us to use PostgreSQL database as well. We need to make small modifications on our code.
Step 1. - Run PostgreSQL database as container I prefer to use containers if I know that the development and the production environment most probably are different."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kicsipixel.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Park API - Using PostgreSQL instead of SQLite","item":"https://kicsipixel.github.io/posts/2023/2023-06-07-postgresql/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Park API - Using PostgreSQL instead of SQLite","name":"Park API - Using PostgreSQL instead of SQLite","description":"In the previous part of the article we built our first API server based on Swift using Hummingbird framework. That time we stored our data in SQLite database, which is perfect for rapid prototyping but for production we need something more robust.\nFeather Database Component allows us to use PostgreSQL database as well. We need to make small modifications on our code.\nStep 1. - Run PostgreSQL database as container I prefer to use containers if I know that the development and the production environment most probably are different.","keywords":["iOS","macOS","swift","server","git","hummingbird","api","postgresql","docker"],"articleBody":"In the previous part of the article we built our first API server based on Swift using Hummingbird framework. That time we stored our data in SQLite database, which is perfect for rapid prototyping but for production we need something more robust.\nFeather Database Component allows us to use PostgreSQL database as well. We need to make small modifications on our code.\nStep 1. - Run PostgreSQL database as container I prefer to use containers if I know that the development and the production environment most probably are different.\nI have created this simple docker-compose.yml :\nversion: '3.7' services: database: image: postgres:15-alpine restart: always env_file: - .env/development/database ports: - 5432:5432 volumes: - db_data:/var/lib/postgresql/data volumes: db_data: The POSTGRES_USER, POSTGRES_PASSWORD, and POSTGRES_DB environment variables are moved to a separate file under .env/development folder.\nThe database file:\nPOSTGRES_USER = hummingbird POSTGRES_PASSWORD = hummingbird_password POSTGRES_DB = hb-parks Run start the container:\ndocker-compose up Step 2. - Add PostgreSQL database dependency to your Package.swift file We need to replace the SQLite component: .product(name: \"HummingbirdSQLiteDatabase\", package: \"hummingbird-db\") to PostgreSQL.\n// Database dependencies .product(name: \"HummingbirdDatabase\", package: \"hummingbird-db\"), .product(name: \"HummingbirdPostgresDatabase\", package: \"hummingbird-db\"), Step 3. - Configure PostgreSQL database in the DatabaseSetup.swift file Creating and connecting to a PostgreSQL database needs more configuration than SQLite. So these changes need to be applied:\nimport Hummingbird import HummingbirdPostgresDatabase extension HBApplication { func setupDatabase() async throws { services.setUpPostgresDatabase( configuration: .init( host: \"localhost\", port: 5432, username: \"hummingbird\", password: \"hummingbird_password\", database: \"hb-parks\", tls: .disable ), eventLoopGroup: eventLoopGroup, logger: logger ) try await db.execute( .init(unsafeSQL: \"\"\" CREATE TABLE IF NOT EXISTS parks ( \"id\" uuid PRIMARY KEY, \"latitude\" double precision NOT NULL, \"longitude\" double precision NOT NULL, \"name\" text NOT NULL ); \"\"\" ) ) } } Obviously the .env/development/database file variables and setUpPostgresDatabase init values must be identical.\nPostgreSQL database uses double precision instead of double as data type.\nStep 4. - That’s all. You can run your server. Once the PostgreSQL database is running in a container and you start you server as:\nswift run parkAPI you are able to connect.\nTools - you can use to make your development process easier Working with databases is not always easy, specially if you don’t have client to test.\nFor basic CRUD operations I use RaidAPI for Mac For checking SQLite database - Base 2 For checking PostgreSQL - TablePlus ","wordCount":"385","inLanguage":"en","datePublished":"2023-06-07T12:04:31+02:00","dateModified":"2023-06-07T12:04:31+02:00","author":[{"@type":"Person","name":"Szabolcs Tóth"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://kicsipixel.github.io/posts/2023/2023-06-07-postgresql/"},"publisher":{"@type":"Organization","name":"Flying blind - coding nonsense","logo":{"@type":"ImageObject","url":"https://kicsipixel.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kicsipixel.github.io accesskey=h title="Flying blind - coding nonsense (Alt + H)">Flying blind - coding nonsense</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kicsipixel.github.io>Home</a>&nbsp;»&nbsp;<a href=https://kicsipixel.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Park API - Using PostgreSQL instead of SQLite</h1><div class=post-meta><span title='2023-06-07 12:04:31 +0200 +0200'>June 7, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Szabolcs Tóth</div></header><div class=post-content><p>In the <a href=https://kicsipixel.github.io/posts/2023/2023-06-02-hummingbird/>previous part of the article</a> we built our first API server based on Swift using <a href=https://github.com/hummingbird-project/hummingbird>Hummingbird</a> framework. That time we stored our data in SQLite database, which is perfect for rapid prototyping but for production we need something more robust.</p><p><a href=https://github.com/FeatherCMS/feather-database>Feather Database Component</a> allows us to use PostgreSQL database as well. We need to make small modifications on our code.</p><h3 id=step-1---run-postgresql-database-as-container>Step 1. - Run PostgreSQL database as container<a hidden class=anchor aria-hidden=true href=#step-1---run-postgresql-database-as-container>#</a></h3><p>I prefer to use containers if I know that the development and the production environment most probably are different.</p><p>I have created this simple <code>docker-compose.yml</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.7&#39;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>database</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:15-alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env_file</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>.env/development/database</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>5432</span>:<span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db_data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>db_data</span>:
</span></span></code></pre></div><p>The <code>POSTGRES_USER</code>, <code>POSTGRES_PASSWORD</code>, and <code>POSTGRES_DB</code> environment variables are moved to a separate file under <code>.env/development</code> folder.</p><p>The <code>database</code> file:</p><pre tabindex=0><code>POSTGRES_USER = hummingbird
POSTGRES_PASSWORD = hummingbird_password
POSTGRES_DB = hb-parks
</code></pre><p>Run start the container:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up
</span></span></code></pre></div><h3 id=step-2---add-postgresql-database-dependency-to-your-packageswift-file>Step 2. - Add PostgreSQL database dependency to your <code>Package.swift</code> file<a hidden class=anchor aria-hidden=true href=#step-2---add-postgresql-database-dependency-to-your-packageswift-file>#</a></h3><p>We need to replace the SQLite component: <code>.product(name: "HummingbirdSQLiteDatabase", package: "hummingbird-db")</code> to PostgreSQL.</p><pre tabindex=0><code> // Database dependencies
                .product(name: &#34;HummingbirdDatabase&#34;, package: &#34;hummingbird-db&#34;),
                .product(name: &#34;HummingbirdPostgresDatabase&#34;, package: &#34;hummingbird-db&#34;),
</code></pre><h3 id=step-3---configure-postgresql-database-in-the-databasesetupswift-file>Step 3. - Configure PostgreSQL database in the <code>DatabaseSetup.swift</code> file<a hidden class=anchor aria-hidden=true href=#step-3---configure-postgresql-database-in-the-databasesetupswift-file>#</a></h3><p>Creating and connecting to a PostgreSQL database needs more configuration than SQLite. So these changes need to be applied:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Hummingbird</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>HummingbirdPostgresDatabase</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>HBApplication</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setupDatabase</span>() async <span style=color:#66d9ef>throws</span> {
</span></span><span style=display:flex><span>        services.setUpPostgresDatabase(
</span></span><span style=display:flex><span>            configuration: .<span style=color:#66d9ef>init</span>(
</span></span><span style=display:flex><span>                host: <span style=color:#e6db74>&#34;localhost&#34;</span>,
</span></span><span style=display:flex><span>                port: <span style=color:#ae81ff>5432</span>,
</span></span><span style=display:flex><span>                username: <span style=color:#e6db74>&#34;hummingbird&#34;</span>,
</span></span><span style=display:flex><span>                password: <span style=color:#e6db74>&#34;hummingbird_password&#34;</span>,
</span></span><span style=display:flex><span>                database: <span style=color:#e6db74>&#34;hb-parks&#34;</span>,
</span></span><span style=display:flex><span>                tls: .disable
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>            eventLoopGroup: eventLoopGroup,
</span></span><span style=display:flex><span>            logger: logger
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> await db.execute(
</span></span><span style=display:flex><span>            .<span style=color:#66d9ef>init</span>(unsafeSQL:
</span></span><span style=display:flex><span>                                   <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                   CREATE TABLE IF NOT EXISTS parks (
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                       &#34;</span>id<span style=color:#e6db74>&#34; uuid PRIMARY KEY,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                       &#34;</span>latitude<span style=color:#e6db74>&#34; double precision NOT NULL,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                       &#34;</span>longitude<span style=color:#e6db74>&#34; double precision NOT NULL,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                       &#34;</span>name<span style=color:#e6db74>&#34; text NOT NULL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                   );
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                                   &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                 )
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Obviously the <code>.env/development/database</code> file variables and <code>setUpPostgresDatabase</code> init values must be identical.</p><p>PostgreSQL database uses <code>double precision</code> instead of <code>double</code> as data type.</p><h3 id=step-4---thats-all-you-can-run-your-server>Step 4. - That&rsquo;s all. You can run your server.<a hidden class=anchor aria-hidden=true href=#step-4---thats-all-you-can-run-your-server>#</a></h3><p>Once the PostgreSQL database is running in a container and you start you server as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>swift run parkAPI
</span></span></code></pre></div><p>you are able to connect.</p><h3 id=tools---you-can-use-to-make-your-development-process-easier>Tools - you can use to make your development process easier<a hidden class=anchor aria-hidden=true href=#tools---you-can-use-to-make-your-development-process-easier>#</a></h3><p>Working with databases is not always easy, specially if you don&rsquo;t have client to test.</p><ul><li>For basic <a href=https://www.freecodecamp.org/news/crud-operations-explained/>CRUD</a> operations I use <a href=https://paw.cloud/>RaidAPI for Mac</a></li><li>For checking SQLite database - <a href=https://menial.co.uk/base/>Base 2</a></li><li>For checking PostgreSQL - <a href=https://tableplus.com/>TablePlus</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kicsipixel.github.io/tags/iOS/>iOS</a></li><li><a href=https://kicsipixel.github.io/tags/macOS/>macOS</a></li><li><a href=https://kicsipixel.github.io/tags/Swift/>Swift</a></li><li><a href=https://kicsipixel.github.io/tags/server/>server</a></li><li><a href=https://kicsipixel.github.io/tags/git/>git</a></li><li><a href=https://kicsipixel.github.io/tags/hummingbird/>hummingbird</a></li><li><a href=https://kicsipixel.github.io/tags/api/>api</a></li><li><a href=https://kicsipixel.github.io/tags/postgresql/>postgresql</a></li><li><a href=https://kicsipixel.github.io/tags/docker/>docker</a></li></ul><nav class=paginav><a class=prev href=https://kicsipixel.github.io/posts/2024/2024-01-17-vapor_tailwind/><span class=title>« Prev</span><br><span>Vapor 4 with Tailwind CSS</span>
</a><a class=next href=https://kicsipixel.github.io/posts/2023/2023-06-02-hummingbird/><span class=title>Next »</span><br><span>Park API - Server side Swift with Hummingbird</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://kicsipixel.github.io>Flying blind - coding nonsense</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>